# Docker Compose for local validation (NOT for benchmarking)
# This is only to verify that servers compile and can start

services:
  # Baseline servers
  stdhttp-h1:
    build:
      context: ..
      dockerfile: docker/Dockerfile.baseline
    command: ["-server", "stdhttp-h1", "-port", "8080"]
    ports:
      - "8081:8080"
    profiles: ["baseline"]

  stdhttp-h2:
    build:
      context: ..
      dockerfile: docker/Dockerfile.baseline
    command: ["-server", "stdhttp-h2", "-port", "8080"]
    ports:
      - "8082:8080"
    profiles: ["baseline"]

  stdhttp-hybrid:
    build:
      context: ..
      dockerfile: docker/Dockerfile.baseline
    command: ["-server", "stdhttp-hybrid", "-port", "8080"]
    ports:
      - "8083:8080"
    profiles: ["baseline"]

  fiber-h1:
    build:
      context: ..
      dockerfile: docker/Dockerfile.baseline
    command: ["-server", "fiber-h1", "-port", "8080"]
    ports:
      - "8084:8080"
    profiles: ["baseline"]

  iris-h2:
    build:
      context: ..
      dockerfile: docker/Dockerfile.baseline
    command: ["-server", "iris-h2", "-port", "8080"]
    ports:
      - "8085:8080"
    profiles: ["baseline"]

  # Theoretical servers (Linux only)
  epoll-h1:
    build:
      context: ..
      dockerfile: docker/Dockerfile.theoretical
    command: ["-server", "epoll-h1", "-port", "8080"]
    ports:
      - "8091:8080"
    profiles: ["theoretical"]
    # Required for raw socket operations
    cap_add:
      - NET_ADMIN
    privileged: true

  epoll-h2:
    build:
      context: ..
      dockerfile: docker/Dockerfile.theoretical
    command: ["-server", "epoll-h2", "-port", "8080"]
    ports:
      - "8092:8080"
    profiles: ["theoretical"]
    cap_add:
      - NET_ADMIN
    privileged: true

  epoll-hybrid:
    build:
      context: ..
      dockerfile: docker/Dockerfile.theoretical
    command: ["-server", "epoll-hybrid", "-port", "8080"]
    ports:
      - "8093:8080"
    profiles: ["theoretical"]
    cap_add:
      - NET_ADMIN
    privileged: true

  iouring-h1:
    build:
      context: ..
      dockerfile: docker/Dockerfile.theoretical
    command: ["-server", "iouring-h1", "-port", "8080"]
    ports:
      - "8094:8080"
    profiles: ["theoretical", "iouring"]
    privileged: true
    # io_uring requires modern kernel
    # Will fail on macOS/Windows/older Linux

  iouring-h2:
    build:
      context: ..
      dockerfile: docker/Dockerfile.theoretical
    command: ["-server", "iouring-h2", "-port", "8080"]
    ports:
      - "8095:8080"
    profiles: ["theoretical", "iouring"]
    privileged: true

  iouring-hybrid:
    build:
      context: ..
      dockerfile: docker/Dockerfile.theoretical
    command: ["-server", "iouring-hybrid", "-port", "8080"]
    ports:
      - "8096:8080"
    profiles: ["theoretical", "iouring"]
    privileged: true
